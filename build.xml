<project basedir="." default="dist" name="Laverca">
  <description>
    Laverca project build file
  </description>
  
  <property value="1.1" name="project-version"/>
  <property value="laverca" name="project-name"/>
	
  <property location="build" name="build"/>
  <property location="dist" name="dist"/>
  <property location="datatypes-src" name="datatypes-src"/>
  <property location="src" name="src"/>
  <property location="samples-src" name="samples-src"/>
  <property location="lib" name="lib"/>
  <property location="etc" name="etc"/>
  <property location="conf" name="conf"/>
  <property location="docs" name="docs"/>
  <property location="start-scripts" name="start-scripts"/>

  <path id="laverca-libs">
    <fileset dir="${lib}"><include name="**/**"/></fileset>
  </path>

  <target name="clean">
    <delete dir="${build}"/>
    <delete dir="${dist}"/>
  </target>

  <target name="init">
    <mkdir dir="${build}"/>
  	<mkdir dir="${dist}"/>
  </target>
  
  <!-- BUILD -->
  
  <target name="build"  depends="build-datatypes, build-laverca, build-samples" />  

  <target name="build-datatypes" depends="init" >
    <mkdir dir="${build}/datatypes"/>
    <javac debug="true" deprecation="true" destdir="${build}/datatypes" encoding="ISO-8859-15" includeantruntime="false">
      <src path="${datatypes-src}"/>
      <classpath>
        <path refid="laverca-libs"/>
      </classpath>
      <include name="**/**.java"/>
    </javac>
    <jar jarfile="${build}/laverca-datatypes.jar">
      <fileset dir="${build}/datatypes">
        <include name="**"/>
      </fileset>
    </jar>
  </target>
  
  <target name="build-laverca" depends="init" >
    <mkdir dir="${build}/laverca"/>
    <javac debug="true" deprecation="true" destdir="${build}/laverca" encoding="ISO-8859-15" includeantruntime="false">
      <src path="${src}"/>
      <classpath>
        <path refid="laverca-libs"/>
        <fileset dir="build" includes="laverca-datatypes.jar"/>
      </classpath>
      <include name="**/**.java"/>
    </javac>
    <jar jarfile="${build}/laverca.jar">
      <fileset dir="${build}/laverca">
        <include name="**"/>
      </fileset>
    </jar>
  </target>

  <target name="build-samples" depends="init" >
    <mkdir dir="${build}/samples"/>
    <javac debug="true" deprecation="true" destdir="${build}/samples" encoding="ISO-8859-15" includeantruntime="false">
      <src path="${samples-src}"/>
      <classpath>
        <path refid="laverca-libs"/>
        <fileset dir="build" includes="laverca-datatypes.jar"/>
        <fileset dir="build" includes="laverca.jar"/>
      </classpath>
      <include name="**/**.java"/>
    </javac>
    <jar jarfile="${build}/laverca-samples.jar">
      <fileset dir="${build}/samples">
        <include name="**"/>
      </fileset>
    </jar>
  </target>
  
  <!-- DIST -->
  
  <target name="dist" depends="build">
  
    <copy todir="${dist}/docs"><fileset dir="${docs}"/></copy>
    <copy todir="${dist}"><fileset dir="${build}" includes="*.jar"/></copy>
	<copy todir="${dist}/datatypes-src"><fileset dir="${datatypes-src}"/></copy>
	<copy todir="${dist}/samples-src"><fileset dir="${samples-src}"/></copy>
  	<copy todir="${dist}/src"><fileset dir="${src}"/></copy>    
	<copy todir="${dist}/start-scripts"><fileset dir="${start-scripts}"/></copy>
	<copy todir="${dist}/etc"><fileset dir="${etc}" /></copy>
    <copy todir="${dist}/conf"><fileset dir="${conf}"/></copy>  
  	<copy todir="${dist}/lib"><fileset dir="${lib}"/></copy>
    
    <copy todir="${dist}">
	  <fileset dir="." includes="LICENSE"/>
      <fileset dir="." includes="NOTICE"/>
      <fileset dir="." includes="README"/>
      <fileset dir="." includes="build.xml"/>	  
	</copy>

  </target>
  
  <!-- MISC -->
  
  <target name="zip" depends="dist">
	<zip destfile="${project-name}-${project-version}.zip" basedir="${dist}"/>
  </target>
	
  <target name="gzip" depends="dist">
	<tar compression="gzip" longfile="gnu" destfile="${project-name}-${project-version}.tar.gz" basedir="${dist}"/>
  </target>
  
  <target name="javadoc"
          description="Generates Laverca documentation.">
		  <mkdir dir="doc"/>
    <javadoc packagenames="fi.laverca.*,fi.ficom.*, org.etsi.*, fi.methics.*"
             sourcepath="src"
             defaultexcludes="yes"
             destdir="doc"
             author="false"
             version="false"
             Private="true"
             use="true"
             windowtitle="Laverca">
			 <classpath>
		       <path refid="laverca-libs"/>
			 </classpath>
      <doctitle><![CDATA[<h1>Laverca v${project-version}</h1>]]></doctitle>
      <group title="Core packages" packages="fi.methics.*"/>
      <group title="ETSI packages" packages="org.etsi.*"/>
      <group title="FiCom packages" packages="fi.ficom.*"/>
    </javadoc>
  </target>

</project>